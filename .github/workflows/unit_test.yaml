name: Test PID Control

on: [push, pull_request]

jobs:
  test_pid:
    name: Test PID Control
    runs-on: ubuntu-18.04
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Setup python 2.7
        uses : actions/setup-python@v2
        with :
          python-version: 2.7

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pytest
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

          sudo sh -c 'echo "deb http://packages.ros.org/ros/ubuntu $(lsb_release -sc) main" > /etc/apt/sources.list.d/ros-latest.list'
          sudo apt-key adv --keyserver 'hkp://keyserver.ubuntu.com:80' --recv-key C1CF6E31E6BADE8868B172B4F42ED6FBAB17C654
          
          sudo apt update
          sudo apt install ros-melodic-ros-base
          source /opt/ros/melodic/setup.bash

      
      - name: Run Tests
        run : |
          pytest ./sauvc_control/tests/


  style_check:
    name: Pylint Style Check
    runs-on: ubuntu-18.04
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Setup python 2.7
        uses : actions/setup-python@v2
        with :
          python-version: 2.7

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pylint
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
      
      - name: Pylint Style Check
        run : |
          pylint --exit-zero -j 0 ./sauvc_control/src/sauvc_control ./sauvc_control/tests/test_pid_controller.py
          
